<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">

  <Package Name="Tp-Note"
           Manufacturer="getreu.net"
           Version="1.0.0"
           UpgradeCode="6F9619FF-8B86-D011-B42D-00C04FC964FF"
           Language="1033"
           Compressed="yes">

    <Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />

    <!-- Installation target -->
    <StandardDirectory Id="ProgramFilesFolder">
      <Directory Id="INSTALLFOLDER" Name="Tp-Note">
        <Component Id="MainExecutable" Guid="91d37a2a-62fc-4f52-9a43-9d8ac5c6c6f5">
          <File Id="TpnoteExe" Source="tpnote.exe" KeyPath="yes" />
        </Component>
        <Component Id="MainIcon" Guid="7e2f0f92-4b5b-4e4e-bc0e-24a6b0a2f88f">
          <File Id="TpnoteIco" Source="tpnote.ico" KeyPath="yes" />
        </Component>
      </Directory>
    </StandardDirectory>

    <!-- Start menu shortcut -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="Tp-Note">
        <Component Id="ApplicationShortcut" Guid="2c9e6cf0-ec8e-4d2a-92aa-84d1ad02af8f">
          <Shortcut Id="ApplicationStartMenuShortcut"
                    Name="Tp-Note"
                    Description="Note-taking tool"
                    Target="[INSTALLFOLDER]tpnote.exe"
                    Icon="TpnoteIco" />
          <RemoveFolder Id="CleanUpShortcuts" On="uninstall" />
          <RegistryValue Root="HKCU" Key="Software\Tpnote" Name="installed" Type="integer" Value="1" KeyPath="yes" />
        </Component>
      </Directory>
    </StandardDirectory>

    <!-- File associations -->
    <Component Id="Assoc_md" Guid="41f72994-0db6-4f2a-b5d8-fd6b377c2b41">
      <RegistryValue Root="HKLM" Key="Software\Classes\.md" Value="TpNote.mdfile" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.mdfile" Value="Markdown Document (Tp-Note)" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.mdfile\DefaultIcon" Value="&quot;[INSTALLFOLDER]tpnote.ico&quot;" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.mdfile\shell" Value="open" Type="string" />
      <!-- Default open -->
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.mdfile\shell\open\command" Value="&quot;[INSTALLFOLDER]tpnote.exe&quot; &quot;%1&quot;" Type="string" KeyPath="yes" />
      <!-- Extra context menu verbs -->
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.mdfile\shell\View" Value="View Tp-Note" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.mdfile\shell\View\command" Value="&quot;[INSTALLFOLDER]tpnote.exe&quot; -v -n &quot;%1&quot;" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.mdfile\shell\Export" Value="Export Tp-Note" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.mdfile\shell\Export\command" Value="&quot;[INSTALLFOLDER]tpnote.exe&quot; -x . -n &quot;%1&quot;" Type="string" />
    </Component>

    <Component Id="Assoc_txtnote" Guid="ed17db8b-25c6-4cc5-8f29-cf424e8ec63b">
      <RegistryValue Root="HKLM" Key="Software\Classes\.txtnote" Value="TpNote.txtnotefile" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.txtnotefile" Value="Tp-Note TextNote Document" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.txtnotefile\DefaultIcon" Value="&quot;[INSTALLFOLDER]tpnote.ico&quot;" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.txtnotefile\shell" Value="open" Type="string" />
      <!-- Default open -->
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.txtnotefile\shell\open\command" Value="&quot;[INSTALLFOLDER]tpnote.exe&quot; &quot;%1&quot;" Type="string" KeyPath="yes" />
      <!-- Extra context menu verbs -->
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.txtnotefile\shell\View" Value="View Tp-Note" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.txtnotefile\shell\View\command" Value="&quot;[INSTALLFOLDER]tpnote.exe&quot; -v -n &quot;%1&quot;" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.txtnotefile\shell\Export" Value="Export Tp-Note" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.txtnotefile\shell\Export\command" Value="&quot;[INSTALLFOLDER]tpnote.exe&quot; -x . -n &quot;%1&quot;" Type="string" />
    </Component>

    <Component Id="Assoc_rst" Guid="c29b7f51-cb58-41c5-9cb0-0672297bbaf3">
      <RegistryValue Root="HKLM" Key="Software\Classes\.rst" Value="TpNote.rstfile" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.rstfile" Value="ReStructuredText Document (Tp-Note)" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.rstfile\DefaultIcon" Value="&quot;[INSTALLFOLDER]tpnote.ico&quot;" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.rstfile\shell" Value="open" Type="string" />
      <!-- Default open -->
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.rstfile\shell\open\command" Value="&quot;[INSTALLFOLDER]tpnote.exe&quot; &quot;%1&quot;" Type="string" KeyPath="yes" />
      <!-- Extra context menu verbs -->
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.rstfile\shell\View" Value="View Tp-Note" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.rstfile\shell\View\command" Value="&quot;[INSTALLFOLDER]tpnote.exe&quot; -v -n &quot;%1&quot;" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.rstfile\shell\Export" Value="Export Tp-Note" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\TpNote.rstfile\shell\Export\command" Value="&quot;[INSTALLFOLDER]tpnote.exe&quot; -x . -n &quot;%1&quot;" Type="string" />
    </Component>

    <!-- Directory background context menu: New Tp-Note -->
    <Component Id="Assoc_dir_background" Guid="a58db4dd-80e8-4a7b-9c85-50e407efc3a7">
      <RegistryValue Root="HKLM" Key="Software\Classes\Directory\Background\shell\NewTpNote" Value="New Tp-Note" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\Directory\Background\shell\NewTpNote\command" Value="&quot;[INSTALLFOLDER]tpnote.exe&quot; &quot;%V&quot;" Type="string" KeyPath="yes" />
    </Component>

    <!-- Desktop background context menu: New Tp-Note -->
    <Component Id="Assoc_desktop_background" Guid="b3f8b1ab-d8a5-4a7c-9171-8c3e9f7354d1">
      <RegistryValue Root="HKLM" Key="Software\Classes\DesktopBackground\Shell\NewTpNote" Value="New Tp-Note" Type="string" />
      <RegistryValue Root="HKLM" Key="Software\Classes\DesktopBackground\Shell\NewTpNote\command" Value="&quot;[INSTALLFOLDER]tpnote.exe&quot; &quot;%V&quot;" Type="string" KeyPath="yes" />
    </Component>

    <!-- Feature tree -->
    <Feature Id="ProductFeature" Title="Tp-Note" Level="1">
      <ComponentRef Id="MainExecutable" />
      <ComponentRef Id="MainIcon" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentRef Id="Assoc_md" />
      <ComponentRef Id="Assoc_txtnote" />
      <ComponentRef Id="Assoc_rst" />
      <ComponentRef Id="Assoc_dir_background" />
      <ComponentRef Id="Assoc_desktop_background" />
    </Feature>

    <!-- Register the icon -->
    <Icon Id="TpnoteIco" SourceFile="tpnote.ico" />

  </Package>
</Wix>
